<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–µ—Å—Ç–∞ -->
        <div class="quest-header">
            <h1 id="questTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞</h1>
            <button class="edit-btn" onclick="editQuestTitle()">‚úèÔ∏è</button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —ç—Ç–∞–ø–æ–≤ -->
        <div class="stages-section">
            <h2>–≠—Ç–∞–ø—ã –∫–≤–µ—Å—Ç–∞</h2>
            <div id="stagesList" class="stages-list">
                <!-- –≠—Ç–∞–ø—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button class="add-stage-btn" onclick="showStageTypeSelector()">+ –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø</button>
        </div>

        <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–∞–ø–∞ -->
        <div id="stageForm" class="stage-form hidden">
            <div class="form-header">
                <h3 id="formTitle">–ù–æ–≤—ã–π —ç—Ç–∞–ø</h3>
                <button class="back-btn" onclick="hideStageForm()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>

            <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ —ç—Ç–∞–ø–∞ -->
            <div id="stageTypeSelector" class="stage-type-selector">
                <h4>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —ç—Ç–∞–ø–∞:</h4>
                <div class="type-buttons">
                    <button onclick="selectStageType('message')">üìù –°–æ–æ–±—â–µ–Ω–∏–µ</button>
                    <button onclick="selectStageType('quiz')">‚ùì –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</button>
                    <button onclick="selectStageType('geo')">üìç –ì–µ–æ —Ç–æ—á–∫–∞</button>
                    <button onclick="selectStageType('question')">üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å</button>
                </div>
            </div>

            <!-- –§–æ—Ä–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —ç—Ç–∞–ø–æ–≤ -->
            <div id="stageForms" class="stage-forms">
                <!-- –§–æ—Ä–º–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div id="messageForm" class="stage-form-content hidden">
                    <label>–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="messageText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
                    <button class="add-completion-btn" onclick="toggleCompletionMessage('message')">
                        üìÑ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                    </button>
                    <div id="messageCompletion" class="completion-message hidden">
                        <label>–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:</label>
                        <textarea id="messageCompletionText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞..."></textarea>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã -->
                <div id="quizForm" class="stage-form-content hidden">
                    <label>–í–æ–ø—Ä–æ—Å:</label>
                    <input type="text" id="quizQuestion" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...">
                    
                    <div id="quizAnswers">
                        <div class="answer-row">
                            <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 1">
                            <input type="checkbox" class="correct-answer">
                            <label>–í–µ—Ä–Ω—ã–π</label>
                        </div>
                        <div class="answer-row">
                            <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 2">
                            <input type="checkbox" class="correct-answer">
                            <label>–í–µ—Ä–Ω—ã–π</label>
                        </div>
                    </div>
                    
                    <button class="add-answer-btn" onclick="addQuizAnswer()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞</button>
                    
                    <button class="add-completion-btn" onclick="toggleCompletionMessage('quiz')">
                        üìÑ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                    </button>
                    <div id="quizCompletion" class="completion-message hidden">
                        <label>–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:</label>
                        <textarea id="quizCompletionText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞..."></textarea>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–ª—è –≥–µ–æ —Ç–æ—á–∫–∏ -->
                <div id="geoForm" class="stage-form-content hidden">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ:</label>
                    <div id="map" class="map-container"></div>
                    <div class="coordinates">
                        <span>–®–∏—Ä–æ—Ç–∞: <span id="latitude">-</span></span>
                        <span>–î–æ–ª–≥–æ—Ç–∞: <span id="longitude">-</span></span>
                    </div>
                    
                    <button class="add-completion-btn" onclick="toggleCompletionMessage('geo')">
                        üìÑ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                    </button>
                    <div id="geoCompletion" class="completion-message hidden">
                        <label>–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:</label>
                        <textarea id="geoCompletionText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞..."></textarea>
                    </div>
                </div>

                <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ -->
                <div id="questionForm" class="stage-form-content hidden">
                    <label>–í–æ–ø—Ä–æ—Å:</label>
                    <input type="text" id="questionText" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...">
                    
                    <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:</label>
                    <div id="correctAnswers">
                        <input type="text" placeholder="–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç 1">
                    </div>
                    <button class="add-answer-btn" onclick="addCorrectAnswer()">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</button>
                    
                    <button class="add-completion-btn" onclick="toggleCompletionMessage('question')">
                        üìÑ –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                    </button>
                    <div id="questionCompletion" class="completion-message hidden">
                        <label>–°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:</label>
                        <textarea id="questionCompletionText" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞..."></textarea>
                    </div>
                </div>
            </div>

            <!-- –û–±—â–∏–µ –ø–æ–ª—è –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ -->
            <div class="stage-name">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞:</label>
                <input type="text" id="stageName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞...">
            </div>

            <button id="submitStageBtn" class="submit-btn" onclick="submitStage()" disabled>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–∞ (–ø–æ–¥–∫–ª—é—á–∞–µ–º Leaflet) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script src="script.js"></script>
</body>
</html>

2. style.css
css

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 100%;
    padding: 20px;
}

.quest-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.quest-header h1 {
    font-size: 1.5em;
    color: #2c3e50;
}

.edit-btn {
    background: #3498db;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    color: white;
    cursor: pointer;
    font-size: 1.2em;
}

.stages-section {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

.stages-section h2 {
    margin-bottom: 15px;
    color: #2c3e50;
}

.stages-list {
    margin-bottom: 15px;
}

.stage-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    margin-bottom: 8px;
    background: #fafafa;
}

.stage-info {
    flex-grow: 1;
}

.stage-number {
    font-weight: bold;
    color: #3498db;
}

.stage-name {
    font-weight: 500;
}

.stage-actions {
    display: flex;
    gap: 8px;
}

.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    font-size: 1.1em;
}

.edit-stage {
    color: #3498db;
}

.delete-stage {
    color: #e74c3c;
}

.add-stage-btn {
    width: 100%;
    padding: 12px;
    background: #27ae60;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 500;
}

.stage-form {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.hidden {
    display: none !important;
}

.form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.back-btn {
    background: #95a5a6;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
}

.stage-type-selector {
    text-align: center;
    margin-bottom: 20px;
}

.type-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 15px;
}

.type-buttons button {
    padding: 15px 10px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9em;
}

.stage-form-content {
    margin-bottom: 20px;
}

.stage-form-content label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #2c3e50;
}

.stage-form-content input[type="text"],
.stage-form-content textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 1em;
}

.stage-form-content textarea {
    min-height: 80px;
    resize: vertical;
}

.answer-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.answer-row input[type="text"] {
    flex-grow: 1;
    margin-bottom: 0;
}

.correct-answer {
    width: auto !important;
}

.add-answer-btn,
.add-completion-btn {
    background: #f39c12;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    margin-bottom: 15px;
    font-size: 0.9em;
}

.map-container {
    height: 300px;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 15px;
    border: 1px solid #ddd;
}

.coordinates {
    display: flex;
    justify-content: space-between;
    font-family: monospace;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
}

.completion-message {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin-top: 10px;
}

.stage-name {
    margin-top: 20px;
}

.stage-name input {
    margin-bottom: 20px;
}

.submit-btn {
    width: 100%;
    padding: 15px;
    background: #27ae60;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 500;
}

.submit-btn:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
}

.submit-btn:not(:disabled):hover {
    background: #219a52;
}
